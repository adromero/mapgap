# Task Registry

| Task ID | Description | Status | Owner | Priority | Depends On | Updated | Summary |
|---------|-------------|--------|-------|----------|------------|---------|---------|
| T1a | **Project init & Vite config**: Run `npm create vite@latest . -- --template react-ts` (or equivalent) to initialize the project. Configure `vite.config.ts` with port 3034, set up `tsconfig.json`. Install all dependencies: maplibre-gl, recharts, vitest, @testing-library/react, @testing-library/jest-dom, jsdom. Install and configure ESLint 9 with flat config (`eslint.config.js`) using `@eslint/js` and `typescript-eslint` — set `"lint": "eslint src/"` in package.json scripts with zero-warning policy (all warnings treated as errors via `--max-warnings 0`). Add `"test": "vitest run"` script to `package.json`. Verify with `npm run build` producing zero errors and `npm run lint` producing zero errors/warnings. | pending | - | 1 | - | 2026-02 | - |
| T1b | **Tailwind, shadcn/ui & project boilerplate**: Install and configure Tailwind CSS 3.4 (not v4) with `tailwind.config.ts` (JS-based config required by shadcn/ui). Set up `src/index.css` with Tailwind directives and Inter font import. Create `src/lib/utils.ts` with the `cn` helper. Install shadcn/ui and generate required primitives: Command, Dialog, Sheet, Drawer, Select, Card. Verify all generated components exist in `src/components/ui/` and `npm run build` still produces zero errors. | pending | - | 1 | T1a | 2026-02 | - |
| T1c | **Test setup, favicon, gitignore & port register**: Create `vitest.config.ts` (environment: jsdom, globals: true, setupFiles: `./src/test/setup.ts`). Create `src/test/setup.ts` with `import '@testing-library/jest-dom'`. Create `public/favicon.svg` (a simple map-pin SVG icon, e.g. a circle with a pointed bottom — does not need to be elaborate). Create `.gitignore` (node_modules, dist, scripts/raw/, .env, .DS_Store, *.local). Update `PORT_REGISTER.md` at `/home/alfonso/Projects/PORT_REGISTER.md` to register port 3034 for product-mapgap (frontend, Vite dev server). Verify `npm run test` runs (may have 0 tests, but should not error) and `npm run build` still produces zero errors. | pending | - | 1 | T1b | 2026-02 | - |
| T2a | **Type definitions & static constants**: Create all TypeScript interfaces in `src/types/` (industry.ts, county.ts, score.ts, index.ts barrel) matching the data models in the architecture document exactly. Create `src/data/colorScales.ts` with the sequential light-to-dark gradient (0=#e5e7eb, 50=#a5b4fc, 100=#3730a3). Create `src/data/stateList.ts` with all 50 US states + DC (abbreviation and name). Verify with `npx tsc --noEmit` producing zero errors. | pending | - | 2 | T1c | 2026-02 | - |
| T2b | **Mock data files for development**: Create the following mock data files. These are used for development and testing only; they will be replaced by real Census data in T11. File formats and paths must match the TypeScript interfaces from T2a exactly. **How to generate**: Write a small inline Node script or hardcode JSON directly — do not over-engineer. Data does not need to be demographically accurate, just structurally valid. (1) `public/data/industries.json` — the 15 industry categories and NAICS codes from the architecture. (2) `public/data/scores/coffee-shops.json`, `scores/gyms.json`, `scores/pet-grooming.json` — each with ~20 entries keyed by FIPS code (use real FIPS codes from a few US states, e.g. 06001, 06037, 36061, 17031, 48201). Scores should span 10-95 for visual testing. (3) `public/data/demographics/counties.json` — demographic entries for the same FIPS codes used in the score files. All fields from `CountyDemographics` must be present. (4) `public/data/counties.geojson` — a minimal GeoJSON FeatureCollection with at least 5 county features. Each feature needs `properties.GEOID` (matching a FIPS from the score files), `properties.NAME`, `properties.STATE`, and a simplified polygon geometry (a simple rectangle/quad per county is fine for dev). This file enables map rendering during development before the real pipeline runs. Verify with `npx tsc --noEmit` zero errors and spot-check one score file parses as valid JSON. | pending | - | 2 | T2a | 2026-02 | - |
| T3 | **Data hooks & state management**: Implement `src/hooks/useIndustryData.ts` (fetches and caches score JSON per industry in a Map/ref; validates industry ID against the loaded industries list before constructing the fetch URL — rejects unknown IDs), `src/hooks/useCountyData.ts` (loads demographics JSON lazily on first county click, provides lookup by FIPS), and `src/hooks/useMapState.ts` (manages selected industry, selected county FIPS, hovered county FIPS, viewport, state filter). Each hook should handle loading/error states. Write Vitest unit tests: verify useIndustryData caches and doesn't re-fetch, verify industry ID validation rejects unknown IDs, verify score data parsing, verify Top 10 sorting logic, verify state filter narrows results. **Testing note:** All hook tests must mock `fetch` using `vi.fn()` / `vi.stubGlobal('fetch', ...)` — do NOT start a dev server or rely on file system access. Provide mock JSON responses inline in the test files. Run `npm run test` with all tests passing. | pending | - | 3 | T2b | 2026-02 | - |
| T4 | **Layout shell & Header**: Build `src/components/layout/Header.tsx` (logo/title left, About link + dark mode toggle right), `Sidebar.tsx` (280px fixed left, responsive collapse), and `MobileSheet.tsx` (shadcn Sheet wrapper for mobile). Implement dark mode toggle using shadcn/ui theme system with Tailwind `dark:` variants. The dark mode toggle state must be exposed via React context or a shared hook (e.g., `useTheme`) so that the MapView component in T6a can read the current theme and switch between CARTO Positron (light) and Dark Matter (dark) basemaps — verify the theme context/hook is accessible from any component in the tree. Wire `App.tsx` with the responsive layout structure (desktop sidebar + map area + detail below; tablet collapsed top bar; mobile full-screen map with sheet). Map area and detail panel can render placeholder divs at this stage. Verify with `npm run build` zero errors and `npx tsc --noEmit` zero errors. | pending | - | 4 | T3 | 2026-02 | - |
| T5 | **Control components & sidebar**: Build `src/components/controls/IndustryPicker.tsx` (shadcn Command combobox searching industries.json), `MetricSelect.tsx` (score vs individual metrics dropdown), and `StateFilter.tsx` (state filter dropdown). Build `src/components/sidebar/TopCountiesList.tsx` (sorted table of top 10 counties by score for selected industry; shows "No results" message when no counties match state filter). Wire these into the Sidebar component from T4. Verify with `npm run build` zero errors and `npx tsc --noEmit` zero errors. | pending | - | 5 | T4 | 2026-02 | - |
| T6a | **MapView & ChoroplethLayer (core rendering)**: Implement `src/components/map/MapView.tsx` initializing MapLibre GL with CARTO Positron basemap, centered on US ([-98.5, 39.8], zoom 4), switching to Dark Matter in dark mode. Show loading spinner overlay while GeoJSON loads; show error message with retry button on GeoJSON load failure. Implement `ChoroplethLayer.tsx` that loads `counties.geojson` as a source when the map mounts, renders a fill layer, and updates `fill-color` paint property with the sequential interpolated match expression from score data when industry changes. Counties with no score data render as gray. **Note:** The mock `counties.geojson` from T2b provides enough geometry to verify rendering during development. Verify with `npm run build` zero errors. | pending | - | 6 | T5 | 2026-02 | - |
| T6a2 | **Map interactions (click, state filter, empty states)**: Wire county click on the map to set selected county FIPS in useMapState. Wire state filter to fitBounds on the selected state's bounding box. Handle empty state: when no counties match the state filter, Top 10 list shows "No results" and map shows the filtered (empty) view. Verify with `npm run build` zero errors. | pending | - | 6 | T6a AND T5 | 2026-02 | - |
| T6b | **MapTooltip, MapLegend & map smoke tests**: Implement `MapTooltip.tsx` showing county name + score on hover (debounced at 16ms); counties with no score data show "No data available" in tooltip. Implement `MapLegend.tsx` showing the sequential gradient with min/max labels. Write smoke tests for MapView, ChoroplethLayer, MapTooltip, and MapLegend rendering via Vitest (`npm run test` passes). Verify with `npm run build` zero errors. | pending | - | 6 | T6a2 | 2026-02 | - |
| T7 | **Detail panel & chart components**: Build `src/components/detail/DetailPanel.tsx` that slides open when a county is selected, showing county name and state. Show skeleton placeholders while demographics load; show inline error with retry on load failure. Build `KPICards.tsx` displaying opportunity score, establishment count, population, and median income as shadcn Cards. Build `AgeChart.tsx` (Recharts bar chart of age distribution buckets), `IncomeChart.tsx` (Recharts bar chart of income brackets), and `ComparisonChart.tsx` (Recharts grouped bar comparing county vs state averages for income, age, density). Use `React.memo` on all chart components. Build `src/components/about/AboutDialog.tsx` as a shadcn Dialog with methodology explanation, data sources, formula, and limitations. Verify with `npm run build` zero errors and write smoke-test rendering tests for each component via Vitest (`npm run test` passes). | pending | - | 7 | T6b | 2026-02 | - |
| T8 | **README & build verification**: Create `README.md` with: project description and live URL, tech stack summary, development setup instructions (`npm install`, `npm run dev`), data pipeline instructions, build and deployment instructions, industry category list, and opportunity score methodology summary (screenshot placeholder is acceptable). Run `npm run lint` with zero errors/warnings (ESLint was configured in T1a). Run `npx tsc --noEmit` with zero type errors. Run `npm run test` with all unit tests passing. Run `npm run build` producing a `dist/` directory. Create `vercel.json` with buildCommand, outputDirectory, and framework settings. Verify final build output includes all static data files in `dist/data/` and `favicon.svg`. | pending | - | 8 | T7 | 2026-02 | - |
| T9a | **Data pipeline: requirements & download scripts**: **Prerequisite:** Verify Python 3.10+ and pip are available (`python3 --version`, `pip3 --version`). If not available, log a clear error and mark this task as blocked. Create `scripts/requirements.txt` with pandas, geopandas, shapely, requests, topojson. Create a virtual environment (`python3 -m venv scripts/.venv`) and install dependencies (`scripts/.venv/bin/pip install -r scripts/requirements.txt`). Add `scripts/.venv/` to `.gitignore` if not already present. Implement `scripts/download_census.py` to download County Business Patterns and ACS 5-Year bulk CSVs from Census Bureau into `scripts/raw/` (gitignored). The script must: (1) retry up to 3 times with exponential backoff on HTTP errors, (2) log the expected URL and HTTP status on failure, (3) if all retries fail, exit with a clear error message explaining what URL was unavailable. Verify: `scripts/.venv/bin/python scripts/download_census.py` runs without errors (or logs a clear blocked message if Census servers are unavailable). **If Census download fails**: mark this task as blocked, note the error, and leave mock data from T2b in place. The frontend does not depend on real data. | pending | - | 9 | T2b | 2026-02 | - |
| T9b | **Data pipeline: process CBP & ACS data**: Implement `scripts/process_cbp.py` to parse CBP data from `scripts/raw/`, map NAICS codes to the 15 industry categories from the architecture, and output establishment counts per county per industry as intermediate JSON in `scripts/processed/`. Implement `scripts/process_acs.py` to extract demographics per county and compute state averages, outputting to `scripts/processed/`. Verify: `scripts/.venv/bin/python scripts/process_cbp.py && scripts/.venv/bin/python scripts/process_acs.py` run without errors against the downloaded data from T9a. **Depends on T9a succeeding** — if T9a is blocked, this task is also blocked. | pending | - | 9 | T9a | 2026-02 | - |
| T10a | **Data pipeline: compute opportunity scores**: Implement `scripts/compute_scores.py` applying the opportunity score formula (pop/biz × income_weight × growth_weight, min-max normalized to 0-100) using processed data from T9b. Output one JSON per industry into `public/data/scores/`. Counties with zero establishments get a capped maximum raw score before normalization. Write a Python unit test (`scripts/test_scores.py`) for the score normalization function verifying: output is in [0, 100] range, zero-establishment counties get a capped score, and the output JSON structure matches the TypeScript `CountyScore` interface field names. Verify: `scripts/.venv/bin/python scripts/compute_scores.py` runs without errors and `scripts/.venv/bin/python -m pytest scripts/test_scores.py` passes. | pending | - | 10 | T9b | 2026-02 | - |
| T10b | **Data pipeline: build GeoJSON**: Implement `scripts/build_geojson.py` to download Census TIGER/Line county shapefiles, simplify geometry (quantization 1e5, tolerance 0.01 — tunable), and output `public/data/counties.geojson`. The script must: (1) log the final file size, (2) warn if file exceeds 3MB, (3) fail if file exceeds 5MB, (4) retry downloads up to 3 times with backoff. Output GeoJSON must have `properties.GEOID`, `properties.NAME`, `properties.STATE` on each feature. Verify: `scripts/.venv/bin/python scripts/build_geojson.py` runs without errors and output file is under 5MB. **If TIGER download fails**: mark as blocked, leave mock GeoJSON from T2b in place. | pending | - | 10 | T9a | 2026-02 | - |
| T11 | **Replace mock data with pipeline output**: Run the full pipeline using the venv from T9a (`scripts/.venv/bin/python scripts/download_census.py` → `process_cbp.py` → `process_acs.py` → `compute_scores.py` → `build_geojson.py`) and verify the generated files in `public/data/` replace the mock data from T2b. Verify the frontend still builds correctly with real data: `npm run build` zero errors, `npm run test` all tests pass. Fix any data format mismatches between pipeline output and frontend expectations. | pending | - | 11 | T8 AND T10a AND T10b | 2026-02 | - |
| T11b | **[MANUAL] Visual verification of real data**: Open the dev server (`npm run dev` on port 3034) in a browser. Verify: (1) the choropleth map renders with real county data and correct color gradients, (2) selecting an industry updates the map colors and Top 10 list, (3) clicking a county opens the detail panel with real demographics, KPI cards, and charts, (4) dark mode toggle switches basemap and theme, (5) mobile responsive layout works. This task requires a human and cannot be completed by an AI agent. | pending | - | 12 | T11 | 2026-02 | - |
